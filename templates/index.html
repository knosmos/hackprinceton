<!DOCTYPE html>
<html>
  <head>
    <title>Posture Monitor Live Stream</title>
    <style>
      body {
        background: #f0f2f5;
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      h1 {
        color: #333;
        margin-bottom: 20px;
      }
      .grid-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        grid-auto-rows: 300px;
        gap: 20px;
        width: 100%;
        max-width: 1280px;
      }
      .box {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 15px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: transform 0.2s ease-in-out;
      }
      .box:hover {
        transform: translateY(-5px);
      }
      img {
        max-width: 100%;
        max-height: 100%;
        border-radius: 8px;
        object-fit: cover;
      }
      #posture-status, #since-sleep {
        font-size: 1.2em;
        color: #555;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>Live Posture Monitor</h1>
    <div class="grid-container">
      <!-- Video Feed -->
      <div class="box">
        <img src="{{ url_for('video_feed') }}" alt="Live Video Feed">
      </div>
      <!-- Posture Status -->
      <div class="box">
        <div id="posture-status">Status: Loading...</div>
      </div>
      <!-- Time Spent in Front of Computer -->
      <div class="box">
        <div id="since-sleep">Time spent in front of computer: 00:00:00</div>
      </div>
      <!-- Graph -->
      <div class="box">
        <img id="graph-img" src="{{ url_for('static', filename='plot.png') }}" alt="Graph of recent scores">
      </div>
    </div>
    
    <script>
      function pollStep() {
        fetch('/step')
          .then(response => response.json())
          .then(data => {
            console.log(data);
            document.getElementById('posture-status').innerText = 
              `Status: ${data.status}, Score: ${data.score}`;
          })
          .catch(error => console.error('Error:', error));
      }
      setInterval(pollStep, 400);

      function refreshGraph() {
        const graphImg = document.getElementById('graph-img');
        graphImg.src = '/graph?time=' + new Date().getTime();
      }
      setInterval(refreshGraph, 400);

      function updateSinceSleep() {
        fetch('/since_sleep')
          .then(response => response.json())
          .then(data => {
            const { hours, minutes, seconds } = data;
            const formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('since-sleep').innerText = `Time spent in front of computer: ${formattedTime}`;
          })
          .catch(error => {
            console.error('Failed to fetch since_sleep time:', error);
          });
      }
      setInterval(updateSinceSleep, 400);
    </script>
  </body>
</html>
